<!DOCTYPE html>
<html lang="fa" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>آزادی‌نت - سرویس VPN حرفه‌ای و رایگان</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/qrcode-generator/1.4.4/qrcode.min.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/all.min.css">
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    fontFamily: {
                        'vazir': ['Vazirmatn', 'Tahoma', 'Arial', 'sans-serif']
                    },
                    animation: {
                        'fade-in': 'fadeIn 0.5s ease-out',
                        'slide-up': 'slideUp 0.6s ease-out forwards',
                        'pulse-fast': 'pulse 2s cubic-bezier(0.4, 0, 0.6, 1) infinite',
                        'gradient-bg': 'gradient-bg 15s ease infinite',
                    },
                    keyframes: {
                        fadeIn: { 'from': { opacity: 0 }, 'to': { opacity: 1 } },
                        slideUp: { 
                            'from': { transform: 'translateY(30px)', opacity: 0 }, 
                            'to': { transform: 'translateY(0)', opacity: 1 } 
                        },
                        'gradient-bg': {
                            '0%, 100%': { 'background-position': '0% 50%' },
                            '50%': { 'background-position': '100% 50%' },
                        }
                    }
                }
            }
        }
    </script>
    <link href="https://fonts.googleapis.com/css2?family=Vazirmatn:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">
    <style>
        body { 
            font-family: 'Vazirmatn', Tahoma, Arial, sans-serif;
            line-height: 1.6;
            scroll-behavior: smooth;
            background: linear-gradient(-45deg, #0f0c29, #302b63, #24243e);
            background-size: 400% 400%;
            animation: gradient-bg 15s ease infinite;
        }
        .card-glass {
            background: rgba(255, 255, 255, 0.05);
            backdrop-filter: blur(15px);
            -webkit-backdrop-filter: blur(15px);
            border: 1px solid rgba(255, 255, 255, 0.1);
            transition: all 0.3s ease;
            box-shadow: 0 8px 32px 0 rgba(0, 0, 0, 0.1);
        }
        .card-glass:hover {
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.2);
            transform: translateY(-5px);
        }
        .status-online {
            background: #10b981;
            box-shadow: 0 0 12px rgba(16, 185, 129, 0.8);
            animation: pulse-fast 2s infinite;
        }
        .ripple { position: relative; overflow: hidden; }
        .ripple::before {
            content: ''; position: absolute; top: 50%; left: 50%;
            width: 0; height: 0; border-radius: 50%;
            background: rgba(255, 255, 255, 0.3);
            transform: translate(-50%, -50%); transition: width 0.6s, height 0.6s;
        }
        .ripple:active::before { width: 300px; height: 300px; }
        .timeline-item::before {
            content: '';
            background: rgba(255,255,255,0.2);
            width: 3px;
            height: 100%;
            position: absolute;
            right: 1.1rem;
            top: 1.5rem;
            z-index: 1;
        }
        .timeline-container > div:last-child .timeline-item::before {
            display: none;
        }
        .faq-answer {
            max-height: 0;
            overflow: hidden;
            transition: max-height 0.5s ease-in-out;
        }
        .animated-section {
            opacity: 0;
        }
        .config-list::-webkit-scrollbar {
            width: 8px;
        }
        .config-list::-webkit-scrollbar-track {
            background: rgba(0,0,0,0.2);
            border-radius: 10px;
        }
        .config-list::-webkit-scrollbar-thumb {
            background: rgba(255,255,255,0.2);
            border-radius: 10px;
        }
        .config-list::-webkit-scrollbar-thumb:hover {
            background: rgba(255,255,255,0.3);
        }
        .ping-badge {
            font-size: 0.75rem;
            padding: 0.25rem 0.5rem;
            border-radius: 9999px;
            min-width: 4.5rem;
            text-align: center;
            display: inline-block;
        }
        .ping-0-100 { background: rgba(16, 185, 129, 0.2); color: #10b981; }
        .ping-101-200 { background: rgba(245, 158, 11, 0.2); color: #f59e0b; }
        .ping-201-500 { background: rgba(245, 158, 11, 0.3); color: #f59e0b; }
        .ping-500 { background: rgba(239, 68, 68, 0.2); color: #ef4444; }
        .ping-failed { background: rgba(239, 68, 68, 0.3); color: #ef4444; }
        .flag-icon {
            width: 24px;
            height: 24px;
            border-radius: 50%;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            margin-left: 0.5rem;
            font-size: 14px;
        }
        .server-card {
            transition: all 0.3s ease;
        }
        .server-card:hover {
            transform: translateY(-3px);
            box-shadow: 0 10px 20px rgba(0,0,0,0.2);
        }
        .ping-progress {
            height: 4px;
            border-radius: 2px;
            background: rgba(255,255,255,0.1);
            overflow: hidden;
        }
        .ping-progress-bar {
            height: 100%;
            background: linear-gradient(90deg, #10b981, #3b82f6);
            transition: width 0.3s ease;
        }
        .server-status {
            width: 10px;
            height: 10px;
            border-radius: 50%;
            display: inline-block;
            margin-left: 8px;
        }
        .status-online { background-color: #10b981; }
        .status-offline { background-color: #ef4444; }
        .status-checking { background-color: #f59e0b; animation: pulse 1.5s infinite; }
        @keyframes pulse {
            0% { opacity: 0.5; }
            50% { opacity: 1; }
            100% { opacity: 0.5; }
        }
    </style>
</head>
<body class="min-h-screen text-gray-200">

    <!-- Header -->
    <header class="py-12 relative overflow-hidden">
        <div class="container mx-auto px-4 relative z-10">
            <div class="text-center animate-fade-in">
                <div class="flex items-center justify-center mb-6">
                    <div class="card-glass rounded-3xl flex items-center justify-center w-16 h-16 ml-4 shadow-2xl">
                        <span class="text-3xl text-white">🚀</span>
                    </div>
                    <div>
                        <h1 class="text-4xl md:text-5xl font-black mb-3 text-white">آزادی‌نت</h1>
                        <p class="text-blue-200 text-lg font-medium">سرویس VPN حرفه‌ای و رایگان</p>
                    </div>
                </div>
            </div>
        </div>
    </header>

    <!-- Main Content Sections -->
    <div class="space-y-12 pb-16 container mx-auto px-4">

        <!-- Mass Ping Test Section -->
        <section id="mass-ping" class="animated-section">
            <div class="card-glass rounded-3xl shadow-2xl p-6 md:p-8 max-w-4xl mx-auto">
                <div class="text-center mb-6">
                    <h2 class="text-3xl font-bold text-white mb-2">
                        تست پینگ جمعی کانفیگ‌ها
                    </h2>
                    <p class="text-gray-300">پینگ و لوکیشن دقیق همه کانفیگ‌ها را یکجا بررسی کنید</p>
                </div>
                
                <div class="card-glass rounded-2xl p-6">
                    <div class="flex flex-col md:flex-row md:items-center justify-between mb-6">
                        <h3 class="text-xl font-bold text-white mb-4 md:mb-0">
                            نتایج تست پینگ سرورها
                        </h3>
                        <button onclick="runMassPing()" id="massPingBtn" class="bg-gradient-to-r from-cyan-500 to-blue-500 hover:from-cyan-600 hover:to-blue-600 text-white px-5 py-2.5 rounded-xl font-semibold text-base ripple transition-all shadow-lg hover:shadow-xl">
                            <i class="fa-solid fa-play ml-2"></i>
                            شروع تست پینگ همه سرورها
                        </button>
                    </div>
                    
                    <div class="mb-4">
                        <div class="flex justify-between mb-1">
                            <span class="text-sm text-gray-300">پیشرفت تست</span>
                            <span id="progressText" class="text-sm text-gray-300">0%</span>
                        </div>
                        <div class="ping-progress">
                            <div id="progressBar" class="ping-progress-bar" style="width: 0%"></div>
                        </div>
                    </div>
                    
                    <div id="mass-ping-results" class="space-y-3 max-h-96 overflow-y-auto config-list pr-2">
                        <div class="text-center py-8 text-gray-400">
                            <i class="fa-solid fa-signal text-3xl mb-4"></i>
                            <p>برای شروع تست پینگ روی دکمه بالا کلیک کنید</p>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- Server Info -->
        <section id="servers" class="animated-section">
            <div class="card-glass rounded-3xl shadow-2xl p-6 md:p-8 max-w-4xl mx-auto">
                <div class="text-center mb-6">
                    <h2 class="text-3xl font-bold text-white mb-2">
                        لیست سرورها
                    </h2>
                    <p class="text-gray-300">سرورهای فعال با پینگ و لوکیشن</p>
                </div>
                
                <div class="space-y-3 max-h-96 overflow-y-auto config-list pr-2">
                    <!-- Server list will be injected here -->
                </div>
            </div>
        </section>

    </div>

    <!-- Footer -->
    <footer class="pt-8 pb-6 relative overflow-hidden">
        <div class="container mx-auto px-4 relative z-10">
            <div class="text-center">
                <h2 class="text-2xl font-bold mb-2 text-white">آزادی‌نت</h2>
                <p class="text-blue-200 text-sm">اینترنت آزاد برای همه، همیشه و همه‌جا</p>
            </div>
            <div class="border-t border-white border-opacity-20 pt-4 text-center text-blue-200 text-xs mt-4">
                <p>
                    © 1404 آزادی‌نت - ساخته شده با ❤️ برای مردم ایران
                </p>
            </div>
        </div>
    </footer>

    <script>
        // Server configurations
        const configs = {
            cf_de_1: { name: 'سرور آلمان ۱', config: 'vless://...', domain: 'de1.azadinet.com' },
            cf_de_2: { name: 'سرور آلمان ۲', config: 'vless://...', domain: 'de2.azadinet.com' },
            cf_fr_1: { name: 'سرور فرانسه ۱', config: 'vless://...', domain: 'fr1.azadinet.com' },
            cf_fr_2: { name: 'سرور فرانسه ۲', config: 'vless://...', domain: 'fr2.azadinet.com' },
            cf_us_1: { name: 'سرور آمریکا ۱', config: 'vless://...', domain: 'us1.azadinet.com' },
            cf_us_2: { name: 'سرور آمریکا ۲', config: 'vless://...', domain: 'us2.azadinet.com' },
            cf_nl_1: { name: 'سرور هلند ۱', config: 'vless://...', domain: 'nl1.azadinet.com' },
            cf_nl_2: { name: 'سرور هلند ۲', config: 'vless://...', domain: 'nl2.azadinet.com' },
            cf_tr_1: { name: 'سرور ترکیه ۱', config: 'vless://...', domain: 'tr1.azadinet.com' },
            cf_tr_2: { name: 'سرور ترکیه ۲', config: 'vless://...', domain: 'tr2.azadinet.com' },
        };

        // Server location data (for demo)
        const serverLocations = {
            'de1.azadinet.com': { country: 'آلمان', city: 'فرانکفورت', flag: '🇩🇪' },
            'de2.azadinet.com': { country: 'آلمان', city: 'برلین', flag: '🇩🇪' },
            'fr1.azadinet.com': { country: 'فرانسه', city: 'پاریس', flag: '🇫🇷' },
            'fr2.azadinet.com': { country: 'فرانسه', city: 'مارسی', flag: '🇫🇷' },
            'us1.azadinet.com': { country: 'آمریکا', city: 'نیویورک', flag: '🇺🇸' },
            'us2.azadinet.com': { country: 'آمریکا', city: 'لس آنجلس', flag: '🇺🇸' },
            'nl1.azadinet.com': { country: 'هلند', city: 'آمستردام', flag: '🇳🇱' },
            'nl2.azadinet.com': { country: 'هلند', city: 'روتردام', flag: '🇳🇱' },
            'tr1.azadinet.com': { country: 'ترکیه', city: 'استانبول', flag: '🇹🇷' },
            'tr2.azadinet.com': { country: 'ترکیه', city: 'آنکارا', flag: '🇹🇷' },
        };

        // Initialize on page load
        document.addEventListener('DOMContentLoaded', function() {
            buildServerList();
            
            // Intersection Observer for animations
            const observer = new IntersectionObserver((entries) => {
                entries.forEach(entry => {
                    if (entry.isIntersecting) {
                        entry.target.classList.add('animate-slide-up');
                    }
                });
            }, { threshold: 0.1 });

            document.querySelectorAll('.animated-section').forEach(section => {
                observer.observe(section);
            });
        });

        // Build server list UI
        function buildServerList() {
            const container = document.querySelector('#servers .config-list');
            container.innerHTML = '';
            
            Object.keys(configs).forEach(key => {
                const configData = configs[key];
                const location = serverLocations[configData.domain] || { country: 'نامشخص', city: 'نامشخص', flag: '🌐' };
                
                const serverEl = document.createElement('div');
                serverEl.className = 'card-glass p-4 flex items-center justify-between';
                serverEl.innerHTML = `
                    <div class="flex items-center">
                        <div class="server-status status-checking" id="status-${key}"></div>
                        <div>
                            <div class="font-bold text-white">${configData.name}</div>
                            <div class="text-gray-400 text-sm flex items-center">
                                <span>${location.city}, ${location.country}</span>
                                <span class="text-lg ml-2">${location.flag}</span>
                            </div>
                        </div>
                    </div>
                    <div class="text-left">
                        <div class="ping-badge animate-pulse" id="ping-${key}">-- ms</div>
                        <div class="text-xs text-gray-400 mt-1">${configData.domain}</div>
                    </div>
                `;
                container.appendChild(serverEl);
            });
        }

        // Run mass ping test
        async function runMassPing() {
            const btn = document.getElementById('massPingBtn');
            const originalBtnText = btn.innerHTML;
            btn.disabled = true;
            btn.innerHTML = '<i class="fa-solid fa-spinner fa-spin ml-2"></i> در حال تست...';
            
            const container = document.getElementById('mass-ping-results');
            container.innerHTML = '<div class="text-center py-6"><i class="fa-solid fa-spinner fa-spin text-2xl mb-3"></i><p>در حال تست سرورها، لطفاً منتظر بمانید...</p></div>';
            
            const results = [];
            const totalConfigs = Object.keys(configs).length;
            let completed = 0;
            
            // Reset progress bar
            document.getElementById('progressBar').style.width = '0%';
            document.getElementById('progressText').textContent = '0%';
            
            for (const [key, config] of Object.entries(configs)) {
                try {
                    // Update server status to checking
                    const statusEl = document.getElementById(`status-${key}`);
                    if (statusEl) {
                        statusEl.className = 'server-status status-checking';
                    }
                    
                    // Step 1: Get server location
                    const location = serverLocations[config.domain] || { country: 'نامشخص', city: 'نامشخص', flag: '🌐' };
                    
                    // Step 2: Ping the server for 5 seconds
                    const pingResult = await pingServer(config.domain, 5000);
                    
                    // Step 3: Save the result
                    results.push({
                        key,
                        config,
                        location,
                        ping: pingResult
                    });
                    
                    // Update UI
                    const pingEl = document.getElementById(`ping-${key}`);
                    if (pingEl) {
                        pingEl.textContent = pingResult;
                        pingEl.className = 'ping-badge ' + getPingClass(pingResult);
                    }
                    
                    if (statusEl) {
                        statusEl.className = 'server-status ' + (pingResult === 'ناموفق' ? 'status-offline' : 'status-online');
                    }
                    
                    // Update progress
                    completed++;
                    const progress = Math.round((completed / totalConfigs) * 100);
                    document.getElementById('progressBar').style.width = `${progress}%`;
                    document.getElementById('progressText').textContent = `${progress}%`;
                    
                    updateMassPingResults(results);
                    
                    // Add a small delay between tests
                    await new Promise(resolve => setTimeout(resolve, 300));
                } catch (error) {
                    results.push({
                        key,
                        config,
                        location: { country: 'نامشخص', city: 'نامشخص', flag: '🌐' },
                        ping: 'ناموفق'
                    });
                    
                    const pingEl = document.getElementById(`ping-${key}`);
                    if (pingEl) {
                        pingEl.textContent = 'ناموفق';
                        pingEl.className = 'ping-badge ping-failed';
                    }
                    
                    const statusEl = document.getElementById(`status-${key}`);
                    if (statusEl) {
                        statusEl.className = 'server-status status-offline';
                    }
                    
                    updateMassPingResults(results);
                }
            }
            
            // Re-enable the button
            btn.disabled = false;
            btn.innerHTML = originalBtnText;
            
            // Show completion message
            showNotification('✅ تست پینگ تمام سرورها با موفقیت انجام شد!', 'success');
        }

        // Update mass ping results UI
        function updateMassPingResults(results) {
            const container = document.getElementById('mass-ping-results');
            
            if (results.length === 0) {
                container.innerHTML = '<div class="text-center py-6 text-gray-400"><i class="fa-solid fa-signal text-2xl mb-3"></i><p>برای شروع تست پینگ روی دکمه بالا کلیک کنید</p></div>';
                return;
            }
            
            container.innerHTML = '';
            
            // Sort results by ping (best first)
            results.sort((a, b) => {
                if (a.ping === 'ناموفق') return 1;
                if (b.ping === 'ناموفق') return -1;
                return parseInt(a.ping) - parseInt(b.ping);
            });
            
            results.forEach(result => {
                const pingClass = getPingClass(result.ping);
                const resultCard = document.createElement('div');
                resultCard.className = 'card-glass p-4 flex items-center justify-between';
                resultCard.innerHTML = `
                    <div class="flex items-center">
                        <div class="server-status ${result.ping === 'ناموفق' ? 'status-offline' : 'status-online'}"></div>
                        <div>
                            <div class="font-bold text-white">${result.config.name}</div>
                            <div class="text-gray-400 text-sm flex items-center">
                                <span>${result.location.city}, ${result.location.country}</span>
                                <span class="text-lg ml-2">${result.location.flag}</span>
                            </div>
                        </div>
                    </div>
                    <div class="text-left">
                        <div class="ping-badge ${pingClass}">${result.ping}</div>
                        <div class="text-xs text-gray-400 mt-1">${result.config.domain}</div>
                    </div>
                `;
                container.appendChild(resultCard);
            });
        }

        // Get ping class for styling
        function getPingClass(pingValue) {
            if (pingValue === 'ناموفق') return 'ping-failed';
            if (pingValue === '--') return '';
            
            const pingNum = parseInt(pingValue);
            if (pingNum <= 100) return 'ping-0-100';
            if (pingNum <= 200) return 'ping-101-200';
            if (pingNum <= 500) return 'ping-201-500';
            return 'ping-500';
        }

        // Ping server with reliable method
        async function pingServer(domain, duration = 5000) {
            return new Promise((resolve) => {
                const startTime = Date.now();
                let successCount = 0;
                let totalLatency = 0;
                let attempts = 0;
                
                // This is a reliable ping method using WebSocket connection timing
                const pingInterval = setInterval(() => {
                    if (Date.now() - startTime >= duration) {
                        clearInterval(pingInterval);
                        
                        if (successCount === 0) {
                            resolve('ناموفق');
                        } else {
                            const avgLatency = Math.round(totalLatency / successCount);
                            resolve(`${avgLatency} ms`);
                        }
                        return;
                    }
                    
                    attempts++;
                    
                    // Use WebSocket for reliable ping measurement
                    const socket = new WebSocket(`wss://${domain}`);
                    const socketStart = Date.now();
                    
                    socket.onopen = () => {
                        const latency = Date.now() - socketStart;
                        totalLatency += latency;
                        successCount++;
                        socket.close();
                    };
                    
                    socket.onerror = () => {
                        // Ignore errors
                    };
                }, 300);
            });
        }

        // UI notification function
        function showNotification(message, type = 'success') {
            const existing = document.querySelector('.notification-toast');
            if(existing) existing.remove();

            const notification = document.createElement('div');
            const bgColor = type === 'success' ? 'bg-green-500' : 'bg-red-500';
            const icon = type === 'success' ? '<i class="fa-solid fa-check-circle"></i>' : '<i class="fa-solid fa-times-circle"></i>';
            
            notification.className = `notification-toast fixed bottom-5 right-5 ${bgColor} text-white px-5 py-3 rounded-xl shadow-lg z-50 flex items-center space-x-3 space-x-reverse animate-fade-in`;
            notification.innerHTML = `<span class="text-xl">${icon}</span> <span class="font-medium">${message}</span>`;
            
            document.body.appendChild(notification);
            
            setTimeout(() => {
                notification.style.transition = 'opacity 0.5s ease, transform 0.5s ease';
                notification.style.opacity = '0';
                notification.style.transform = 'translateX(100%)';
                setTimeout(() => notification.remove(), 500);
            }, 3000);
        }
    </script>
</body>
</html>